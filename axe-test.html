<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UUStreak Accessibility Tester</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.5;
    }
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      margin: -1px;
      padding: 0;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    input[type="text"] {
      width: 100%;
      max-width: 600px;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-right: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      background: #000;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
    button:focus {
      outline: 2px solid #0066cc;
      outline-offset: 2px;
    }
    iframe {
      width: 100%;
      min-height: 420px;
      border: 1px solid #ccc;
      margin-top: 1rem;
    }
    pre {
      background: #f6f6f6;
      padding: 1rem;
      border-radius: 6px;
      overflow: auto;
      max-height: 600px;
      font-family: "JetBrains Mono", "SFMono-Regular", Menlo, monospace;
      font-size: 0.9rem;
    }
    .warning {
      color: #b45309;
      background: #fef3c7;
      padding: 0.5rem;
      border-radius: 4px;
      margin-top: 1rem;
    }
    .violation {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }
    .impact-critical { color: #dc2626; }
    .impact-serious { color: #ea580c; }
    .impact-moderate { color: #d97706; }
    .impact-minor { color: #ca8a04; }
    .selector {
      background: #e0e7ff;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-family: monospace;
      font-size: 0.85rem;
    }
    .html-snippet {
      background: #1e293b;
      color: #e2e8f0;
      padding: 0.5rem;
      border-radius: 4px;
      margin: 0.5rem 0;
      overflow-x: auto;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>UUStreak axe-core tester</h1>
      <p>Enter any page on this domain (same origin) to load it in the iframe and run axe-core checks. External URLs will usually be blocked by browser security.</p>
    </header>
    <section aria-labelledby="test-section-heading">
      <h2 id="test-section-heading" class="visually-hidden">Test Configuration</h2>
      <label for="urlInput">URL to test:</label>
      <input type="text" id="urlInput" placeholder="https://uustreak.no/your-page.html" value="https://uustreak.no/index.html">
      <div style="margin-top: 1rem;" aria-live="polite">
        <button onclick="loadAndTest()">Load & test</button>
        <button onclick="clearResults()">Clear</button>
      </div>
      <div class="warning">You can only run axe-core on same-origin pages here. Cross-origin URLs need backend proxies, crawler services, or the axe DevTools browser extension.</div>
      <iframe id="testFrame" title="Page under test"></iframe>
    </section>
    <section aria-labelledby="results-heading">
      <h2 id="results-heading">Results</h2>
      <pre id="results">Waiting for a test...</pre>
    </section>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axe-core/4.8.4/axe.min.js"></script>
  <script>
    const iframe = document.getElementById('testFrame');
    const resultsEl = document.getElementById('results');

    function escapeHtml(html) {
      return html.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    async function loadAndTest() {
      const url = document.getElementById('urlInput').value.trim();
      console.log('üîç loadAndTest called with URL:', url);
      
      if (!url) {
        resultsEl.textContent = 'Please enter a URL to test.';
        return;
      }

      resultsEl.textContent = 'Loading page...';
      console.log('üìÑ Setting iframe.src to:', url);
      iframe.src = url;

      iframe.onload = async () => {
        console.log('‚úÖ iframe.onload fired');
        console.log('üìç iframe.src:', iframe.src);
        console.log('üìç iframe.contentWindow.location.href:', iframe.contentWindow?.location?.href);
        
        try {
          // Check what document we're actually accessing
          const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
          console.log('üìÑ iframeDoc:', iframeDoc);
          console.log('üìÑ iframeDoc.URL:', iframeDoc?.URL);
          console.log('üìÑ iframeDoc.title:', iframeDoc?.title);
          console.log('üìÑ iframeDoc.body:', iframeDoc?.body);
          
          if (!iframeDoc) {
            throw new Error('Cannot access iframe content document. Likely blocked by CORS policy.');
          }
          
          console.log('üî¨ Running axe.run on iframeDoc...');
          const results = await axe.run(iframeDoc);
          console.log('‚úÖ axe.run completed');
          console.log('üìä Results:', results);
          console.log('üìä Violations count:', results.violations.length);
          console.log('üìä URL tested:', results.url);
          
          let output = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë              AXE-CORE ACCESSIBILITY REPORT                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

URL: ${url}
Tested URL: ${results.url || 'N/A'}
Date: ${new Date().toLocaleString()}

SUMMARY:
  ‚Ä¢ Violations: ${results.violations.length}
  ‚Ä¢ Passes: ${results.passes.length}
  ‚Ä¢ Incomplete: ${results.incomplete.length}
  ‚Ä¢ Inapplicable: ${results.inapplicable.length}

`;

          if (results.violations.length === 0) {
            output += '‚úì No violations found!\n';
          } else {
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            output += '                      VIOLATIONS FOUND                        \n';
            output += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            results.violations.forEach((violation, index) => {
              const impactLabel = violation.impact ? violation.impact.toUpperCase() : 'UNKNOWN';
              
              output += `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n`;
              output += `‚îÇ VIOLATION ${index + 1} of ${results.violations.length}\n`;
              output += `‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n`;
              output += `ID: ${violation.id}\n`;
              output += `Impact: [${impactLabel}]\n`;
              output += `Issue: ${violation.help}\n`;
              output += `Description: ${violation.description}\n`;
              output += `WCAG: ${violation.tags.join(', ')}\n`;
              output += `Help URL: ${violation.helpUrl}\n`;
              output += `Elements Affected: ${violation.nodes.length}\n\n`;

              violation.nodes.forEach((node, nodeIndex) => {
                output += `  ‚îå‚îÄ‚îÄ Element ${nodeIndex + 1} ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                output += `  ‚îÇ\n`;
                output += `  ‚îÇ CSS Selector:\n`;
                output += `  ‚îÇ   ${node.target.join(' ')}\n`;
                output += `  ‚îÇ\n`;
                
                if (node.html) {
                  output += `  ‚îÇ HTML:\n`;
                  const htmlLines = node.html.split('\n');
                  htmlLines.forEach(line => {
                    output += `  ‚îÇ   ${line}\n`;
                  });
                  output += `  ‚îÇ\n`;
                }

                if (node.failureSummary) {
                  output += `  ‚îÇ Failure Summary:\n`;
                  const summaryLines = node.failureSummary.split('\n');
                  summaryLines.forEach(line => {
                    if (line.trim()) {
                      output += `  ‚îÇ   ${line.trim()}\n`;
                    }
                  });
                  output += `  ‚îÇ\n`;
                }

                if (node.any && node.any.length > 0) {
                  output += `  ‚îÇ Fix any of:\n`;
                  node.any.forEach(check => {
                    output += `  ‚îÇ   ‚Ä¢ ${check.message}\n`;
                  });
                  output += `  ‚îÇ\n`;
                }

                if (node.all && node.all.length > 0) {
                  output += `  ‚îÇ Fix all of:\n`;
                  node.all.forEach(check => {
                    output += `  ‚îÇ   ‚Ä¢ ${check.message}\n`;
                  });
                  output += `  ‚îÇ\n`;
                }

                if (node.none && node.none.length > 0) {
                  output += `  ‚îÇ Fix none of:\n`;
                  node.none.forEach(check => {
                    output += `  ‚îÇ   ‚Ä¢ ${check.message}\n`;
                  });
                  output += `  ‚îÇ\n`;
                }

                output += `  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n`;
              });

              output += '\n';
            });
          }

          resultsEl.innerHTML = escapeHtml(output);
        } catch (error) {
          console.error('‚ùå Error during axe test:', error);
          console.error('‚ùå Error stack:', error.stack);
          resultsEl.textContent = 'Error: ' + error.message + '\n\nIf you are testing a cross-origin page, the browser blocks access for security reasons. Test one of your own site pages or use a backend proxy.';
        }
      };

      iframe.onerror = (error) => {
        console.error('‚ùå iframe.onerror fired:', error);
        resultsEl.textContent = 'Unable to load the page. Check that the URL is on the same origin or that the page allows embedding.';
      };
    }

    function clearResults() {
      console.log('üßπ Clearing results');
      iframe.src = 'about:blank';
      resultsEl.textContent = 'Waiting for a test...';
    }
  </script>
</body>
</html>